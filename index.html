<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title id="pageTitle">Mister Fitness - Gym Registration & Fees</title>
<!-- Load Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* --- CUSTOM STYLES (Mobile-Optimized) --- */
body { 
    font-family: 'Inter', sans-serif; 
    margin:0; 
    padding:0; 
    background:linear-gradient(135deg,#4facfe,#00f2fe); 
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}
header { 
    text-align:center; 
    padding:1rem; 
    color:#fff; 
    font-size:1.625rem; 
    font-weight:bold; 
    background-color: #1f2937; /* Darker header for contrast */
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.container { 
    /* Adaptive width and centered layout */
    margin: 20px auto; 
    padding: 1.5rem; 
    border-radius: 0.75rem; 
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    width: 95%; /* Fluid width on mobile */
    max-width: 600px; /* Max width for desktop readability */
    flex-grow: 1; /* Allow content to push footer down if there was one */
}

.reg-display { 
    padding: 10px; 
    background: #e0f7fa; 
    border: 1px dashed #00bcd4; 
    border-radius: 6px; 
    margin-bottom: 15px; 
    text-align: center; 
    font-weight: bold; 
    font-size: 1.1em; 
    color: #007bff;
}

/* Modal Styles */
.modal { 
    display:none; 
    position:fixed; 
    top:0; 
    left:0; 
    width:100%; 
    height:100%; 
    background:rgba(0,0,0,0.7); 
    justify-content:center; 
    align-items:center; 
    z-index:1000; 
    padding: 10px;
}
.modal-content { 
    background:#fff; 
    padding:20px; 
    border-radius:12px; 
    width:95%; /* Responsive width for modal */
    max-width:600px; 
    position:relative; 
}

img.member-photo { 
    width:70px; 
    height:70px; 
    object-fit:cover; 
    border-radius:50%; 
    border: 3px solid #007bff; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Custom Message Box for Mobile */
#messageBox {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    z-index: 2000;
    font-size: 0.9rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

/* Hide utility */
.hidden { display:none !important; }

/* Table specific styling for responsiveness */
#memberTable th, #feeTable th {
    /* Ensure headers are visible and clear */
    text-align: left;
    white-space: nowrap; /* Prevent headers from wrapping */
    font-size: 0.85rem;
}
#memberTable td, #feeTable td {
    /* Smaller font for data cells on mobile */
    font-size: 0.8rem;
    padding: 0.75rem 0.5rem;
    white-space: nowrap;
}

</style>
</head>
<body class="selection:bg-blue-200">

<header>Mister Fitness ЁЯПЛя╕П</header>
<div class="language absolute top-4 right-5 cursor-pointer text-3xl text-white drop-shadow-lg" onclick="toggleLanguage()">ЁЯМР</div>

<!-- Custom Message Box (Replaces alert()) -->
<div id="messageBox" class="hidden"></div>


<!-- Login Page Container (Tailwind classes for structure) -->
<div class="container bg-white mx-auto shadow-2xl" id="loginPage">
    <h2 id="loginTitle" class="text-center text-2xl font-bold text-blue-600 mb-6 border-b-2 border-blue-400 pb-2">ЁЯФР роЙро│рпНроирпБро┤рпИро╡рпБ</h2>
    
    <div class="mb-4">
        <input type="text" id="username" placeholder="рокропройро░рпН рокрпЖропро░рпН" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
    </div>
    <div class="mb-6">
        <input type="password" id="password" placeholder="роХроЯро╡рпБроЪрпНроЪрпКро▓рпН" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
    </div>
    
    <button onclick="login()" id="loginBtn" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-200 active:scale-[0.99] shadow-md">роЙро│рпНроирпБро┤рпИ</button>
</div>

<!-- Member Registration Page Container (Tailwind classes for structure) -->
<div class="container bg-white mx-auto shadow-2xl hidden" id="memberPage">
    <h2 id="memberTitle" class="text-center text-2xl font-bold text-blue-600 mb-6 border-b-2 border-blue-400 pb-2">ЁЯСд роЙро▒рпБрокрпНрокро┐ройро░рпН рокродро┐ро╡рпБ</h2>
    
    <input type="hidden" id="editId">

    <!-- Display for the generated registration number -->
    <div id="regNoDisplay" class="reg-display hidden"></div>
    
    <!-- Input Fields (Responsive Grid) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <input type="text" id="name" placeholder="рокрпЖропро░рпН" class="p-3 border border-gray-300 rounded-lg">
        <input type="number" id="age" placeholder="ро╡ропродрпБ" class="p-3 border border-gray-300 rounded-lg">
        <input type="text" id="mobile" placeholder="роХрпИрокрпЗроЪро┐ роОрогрпН" class="p-3 border border-gray-300 rounded-lg">
        <input type="email" id="email" placeholder="рооро┐ройрпНройроЮрпНроЪро▓рпН" class="p-3 border border-gray-300 rounded-lg">
    </div>
    
    <input type="text" id="address" placeholder="роорпБроХро╡ро░ро┐" class="w-full p-3 border border-gray-300 rounded-lg mt-4">
    <input type="text" id="aadhaar" placeholder="роЖродро╛ро░рпН роОрогрпН" class="w-full p-3 border border-gray-300 rounded-lg mt-4">

    <!-- Plan and Date (Responsive Grid) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
        <div>
            <label for="plan" id="planLabel" class="block text-sm font-semibold text-gray-700 mb-1">роЙро▒рпБрокрпНрокро┐ройро░рпН родро┐роЯрпНроЯроорпН:</label>
            <select id="plan" class="w-full p-3 border border-gray-300 rounded-lg"></select>
        </div>
        <div>
            <label for="startDate" id="startDateLabel" class="block text-sm font-semibold text-gray-700 mb-1">роЪрпЗро░рпНроХрпНроХрпИ родрпЗродро┐:</label>
            <input type="date" id="startDate" class="w-full p-3 border border-gray-300 rounded-lg">
        </div>
    </div>

    <!-- Medical and Fees Status (Responsive Grid) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
        <div>
            <label id="medicalLabel" class="block text-sm font-semibold text-gray-700 mb-1">рооро░рпБродрпНродрпБро╡ рокро┐ро░роЪрпНроЪро┐ройрпИроХро│рпН:</label>
            <select id="medical" class="w-full p-3 border border-gray-300 rounded-lg">
                <!-- Options populated by JS for translation -->
            </select>
        </div>
        <div>
            <label id="feesLabel" class="block text-sm font-semibold text-gray-700 mb-1">роХроЯрпНроЯрогроорпН роЪрпЖро▓рпБродрпНродрокрпНрокроЯрпНроЯродро╛?</label>
            <select id="feesStatus" class="w-full p-3 border border-gray-300 rounded-lg">
                <!-- Options populated by JS for translation -->
            </select>
        </div>
    </div>
    
    <textarea id="medicalDetails" placeholder="роЖроорпН роОройрпНро▒ро╛ро▓рпН, роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯрпБ роОро┤рпБродро╡рпБроорпН" style="min-height: 80px;" class="w-full p-3 border border-gray-300 rounded-lg mt-4"></textarea>
    
    <!-- Payment Method and Photo (Responsive Grid) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
        <div>
            <label for="paymentMethod" id="paymentMethodLabel" class="block text-sm font-semibold text-gray-700 mb-1">роХроЯрпНроЯрог роорпБро▒рпИ:</label>
            <select id="paymentMethod" class="w-full p-3 border border-gray-300 rounded-lg"></select>
        </div>
        <div>
            <label id="photoLabel" class="block text-sm font-semibold text-gray-700 mb-1">роЙро▒рпБрокрпНрокро┐ройро░рпН рокрпБроХрпИрокрпНрокроЯроорпН:</label>
            <input type="file" id="photo" accept="image/*" class="w-full text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
        </div>
    </div>

    <button onclick="registerMember()" id="registerBtn" class="w-full py-3 mt-6 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-200 active:scale-[0.99] shadow-md">рокродро┐ро╡рпБ</button>
    <button class="logout w-full py-3 mt-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-200 active:scale-[0.99] shadow-md" onclick="logout()" id="logoutBtn">ро╡рпЖро│ро┐ропрпЗро▒рпБ</button>
</div>

<!-- Admin Pages -->
<div class="container bg-white mx-auto shadow-2xl hidden" id="adminPage">
    <h2 id="adminTitle" class="text-center text-2xl font-bold text-blue-600 mb-6 border-b-2 border-blue-400 pb-2">ЁЯУЛ роЙро▒рпБрокрпНрокро┐ройро░рпН рокродро┐ро╡рпБроХро│рпН</h2>
    <button onclick="document.getElementById('adminPage').classList.add('hidden'); document.getElementById('memberPage').classList.remove('hidden'); clearForm();" class="w-full py-2 mb-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-200 active:scale-[0.99] shadow-md">+ рокрпБродро┐роп роЙро▒рпБрокрпНрокро┐ройро░рпН</button>
    
    <!-- Search Bar for Member Records -->
    <div class="mb-4 relative">
        <input type="text" id="memberSearchInput" onkeyup="loadMembers()" placeholder="Reg.No, рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роорпКрокрпИро▓рпН роорпВро▓роорпН родрпЗроЯрпБ" class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
        <!-- Search Icon SVG -->
        <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
    </div>
    
    <!-- Table Wrapper for Mobile Responsiveness -->
    <div class="overflow-x-auto">
        <table id="memberTable" class="min-w-full divide-y divide-gray-200 rounded-lg shadow-lg"></table>
    </div>
    <button onclick="gotoFeePage()" id="feeBtn" class="w-full py-3 mt-4 bg-yellow-400 text-gray-900 font-semibold rounded-lg hover:bg-yellow-500 transition duration-200 active:scale-[0.99] shadow-md">ЁЯТ╡ роХроЯрпНроЯрогроЩрпНроХро│рпН</button>
    <button class="logout w-full py-3 mt-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-200 active:scale-[0.99] shadow-md" onclick="logout()" id="logoutBtn2">ро╡рпЖро│ро┐ропрпЗро▒рпБ</button>
</div>

<div class="container bg-white mx-auto shadow-2xl hidden" id="feePage">
    <h2 id="feeTitle" class="text-center text-2xl font-bold text-blue-600 mb-6 border-b-2 border-blue-400 pb-2">ЁЯТ╡ роХроЯрпНроЯрог ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h2>
    
    <!-- Search Bar for Fee Details -->
    <div class="mb-4 relative">
        <input type="text" id="feeSearchInput" onkeyup="loadMembers()" placeholder="Reg.No, рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роорпКрокрпИро▓рпН роорпВро▓роорпН родрпЗроЯрпБ" class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
        <!-- Search Icon SVG -->
        <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
    </div>
    
    <!-- Table Wrapper for Mobile Responsiveness -->
    <div class="overflow-x-auto">
        <table id="feeTable" class="min-w-full divide-y divide-gray-200 rounded-lg shadow-lg"></table>
    </div>
    <button onclick="backToAdmin()" id="backBtn" class="w-full py-3 mt-4 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-200 active:scale-[0.99] shadow-md">ЁЯФЩ рокро┐ройрпН</button>
</div>

<!-- Member Details Modal -->
<div class="modal" id="memberModal">
<div class="modal-content">
<button class="close-btn bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-md absolute top-3 right-3 transition duration-150" onclick="closeModal()">Close</button>
<h3 id="modalTitle" class="text-center text-xl font-bold text-gray-800 mt-2 mb-4">Member Details</h3>
<img id="modalPhoto" class="member-photo mx-auto" src="" alt="Member Photo" onerror="this.onerror=null;this.src='https://placehold.co/70x70/cccccc/333333?text=N/A';" />
<div class="overflow-x-auto mt-4">
    <table id="detailTable" class="min-w-full divide-y divide-gray-200"></table>
</div>
</div>
</div>

<script>
// Global variables
let users={"admin":"1234","member":"1234"};
let role="";
let members=[];
let lang="ta";
let messageTimeout = null;

// --- UTILITY FUNCTIONS (Added/Completed) ---

/**
 * Displays a custom message box instead of alert().
 * @param {string} msg 
 */
function displayMessage(msg) {
    clearTimeout(messageTimeout);
    const messageBox = document.getElementById('messageBox');
    messageBox.textContent = msg;
    messageBox.classList.remove('hidden');
    messageBox.style.opacity = 1;
    messageTimeout = setTimeout(() => {
        messageBox.style.opacity = 0;
        setTimeout(() => messageBox.classList.add('hidden'), 300);
    }, 3000);
}

// Close Modal
function closeModal() {
    document.getElementById('memberModal').style.display = 'none';
}

// Navigate to Fee Page
function gotoFeePage() {
    document.getElementById('adminPage').classList.add('hidden');
    document.getElementById('feePage').classList.remove('hidden');
    // Clear the fee search input before loading members for fee page
    document.getElementById('feeSearchInput').value = ''; 
    loadMembers();
}

// Navigate back to Admin Page
function backToAdmin() {
    document.getElementById('feePage').classList.add('hidden');
    document.getElementById('adminPage').classList.remove('hidden');
    // Clear the member search input before loading members for admin page
    document.getElementById('memberSearchInput').value = '';
    loadMembers();
}


// --- REGISTRATION NUMBER LOGIC (SIMPLIFIED AS REQUESTED) ---

/**
 * Generates the next unique Registration Number in the requested DD/MM/C101 format.
 * NOTE: C101 is hardcoded as sequential counter logic for C is complex to maintain with local storage.
 */
function generateRegNo(dateString) {
    const date = new Date(dateString);
    // Ensure date is valid
    if (isNaN(date) || dateString === "") {
        displayMessage(lang === "ta" ? "тЪая╕П роЪрпЗро░рпНроХрпНроХрпИ родрпЗродро┐ роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХро╡ро┐ро▓рпНро▓рпИ. рокродро┐ро╡рпБ роЪрпЖропрпНро╡родро▒рпНроХрпБ роорпБройрпН роЪрпЗро░рпНроХрпНроХрпИ родрпЗродро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН." : "тЪая╕П Joining Date is not valid. Please select a Joining Date before registering.");
        return null;
    }
    
    // DD/MM format
    const dd = String(date.getDate()).padStart(2, '0');
    const mm = String(date.getMonth() + 1).padStart(2, '0');
    
    // Format requested: DD/MM/C101
    return `${dd}/${mm}/C101`; 
}

// --- LANGUAGE/TRANSLATION LOGIC ---

// Function to update dropdown options based on current language
function updateSelectOptions() {
    // 1. Plan Options
    const planSelect = document.getElementById('plan');
    // Store current value to re-select after update
    const selectedPlan = planSelect.value;
    planSelect.innerHTML = `<option value="">${lang === "ta" ? "роЙро▒рпБрокрпНрокро┐ройро░рпН родро┐роЯрпНроЯроорпН" : "Membership Plan"}</option>`;
    const plans = [
        { ta: "рооро╛родроорпН - тВ╣400", en: "Monthly - тВ╣400", value: "Monthly - тВ╣400" },
        { ta: "роХро╛ро▓ро╛рогрпНроЯрпБ - тВ╣1200", en: "Quarterly - тВ╣1200", value: "Quarterly - тВ╣1200" },
        { ta: "ро╡ро░рпБроЯроорпН - тВ╣4800", en: "Annual - тВ╣4800", value: "Annual - тВ╣4800" },
    ];
    plans.forEach(plan => {
        const option = document.createElement('option');
        option.value = plan.value; 
        option.textContent = lang === "ta" ? plan.ta : plan.en;
        if (plan.value === selectedPlan) option.selected = true;
        planSelect.appendChild(option);
    });

    // 2. Medical Options
    const medicalSelect = document.getElementById('medical');
    const selectedMedical = medicalSelect.value;
    medicalSelect.innerHTML = `
        <option value="No">${lang === "ta" ? "роЗро▓рпНро▓рпИ" : "No"}</option>
        <option value="Yes">${lang === "ta" ? "роЖроорпН" : "Yes"}</option>
    `;
    if (selectedMedical) medicalSelect.value = selectedMedical;


    // 3. Fees Status Options
    const feesSelect = document.getElementById('feesStatus');
    const selectedFees = feesSelect.value;
    feesSelect.innerHTML = `
        <option value="Not Paid">${lang === "ta" ? "роХроЯрпНроЯрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ" : "Not Paid"}</option>
        <option value="Paid">${lang === "ta" ? "роХроЯрпНроЯрокрпНрокроЯрпНроЯродрпБ" : "Paid"}</option>
    `;
    if (selectedFees) feesSelect.value = selectedFees;

    // 4. Payment Method Options
    const paymentMethodSelect = document.getElementById('paymentMethod');
    const selectedMethod = paymentMethodSelect.value;
    paymentMethodSelect.innerHTML = `<option value="">${lang === "ta" ? "роХроЯрпНроЯрог роорпБро▒рпИ родрпЗро░рпНро╡рпБ" : "Select Payment Method"}</option>`;
    const methods = [
        { ta: "рокрогроорпН (Cash)", en: "Cash", value: "Cash" },
        { ta: "GPay", en: "GPay", value: "GPay" },
    ];
    methods.forEach(method => {
        const option = document.createElement('option');
        option.value = method.value;
        option.textContent = lang === "ta" ? method.ta : method.en;
        if (method.value === selectedMethod) option.selected = true;
        paymentMethodSelect.appendChild(option);
    });
}

// Update language for placeholders and buttons
function updateLanguage(){
    // Update Select Options (must be done first)
    updateSelectOptions();

    // Update Titles & Buttons
    document.getElementById("pageTitle").innerText = (lang=="ta")?"Mister Fitness - роЬро┐роорпН рокродро┐ро╡рпБ & роХроЯрпНроЯрогроЩрпНроХро│рпН":"Mister Fitness - Gym Registration & Fees";
    document.getElementById("loginTitle").innerText = (lang=="ta")?"ЁЯФР роЙро│рпНроирпБро┤рпИро╡рпБ":"ЁЯФР Login";
    document.getElementById("loginBtn").innerText = (lang=="ta")?"роЙро│рпНроирпБро┤рпИ":"Login";
    document.getElementById("memberTitle").innerText = (lang=="ta")?"ЁЯСд роЙро▒рпБрокрпНрокро┐ройро░рпН рокродро┐ро╡рпБ":"ЁЯСд Member Registration";
    
    // Check if in edit mode to set button text
    const registerBtn = document.getElementById("registerBtn");
    registerBtn.innerText = document.getElementById("editId").value ? (lang === "ta" ? "рокрпБродрпБрокрпНрокро┐роХрпНроХ" : "Update") : (lang === "ta" ? "рокродро┐ро╡рпБ" : "Register");

    document.getElementById("adminTitle").innerText = (lang=="ta")?"ЁЯУЛ роЙро▒рпБрокрпНрокро┐ройро░рпН рокродро┐ро╡рпБроХро│рпН":"ЁЯУЛ Member Records";
    document.getElementById("feeTitle").innerText = (lang=="ta")?"ЁЯТ╡ роХроЯрпНроЯрог ро╡ро┐ро╡ро░роЩрпНроХро│рпН":"ЁЯТ╡ Fee Details";
    document.getElementById("backBtn").innerText = (lang=="ta"?"ЁЯФЩ рокро┐ройрпН":"ЁЯФЩ Back");
    document.getElementById("feeBtn").innerText = (lang=="ta"?"ЁЯТ╡ роХроЯрпНроЯрогроЩрпНроХро│рпН":"ЁЯТ╡ Fees");
    document.getElementById("modalTitle").innerText = (lang=="ta"?"роЙро▒рпБрокрпНрокро┐ройро░рпН ро╡ро┐ро╡ро░роЩрпНроХро│рпН":"Member Details");
    document.querySelectorAll(".logout").forEach(b=>b.innerText=(lang=="ta")?"ро╡рпЖро│ро┐ропрпЗро▒рпБ":"Logout");
    
    const newMemberButton = document.querySelector('#adminPage button:nth-child(2)');
    if (newMemberButton) {
        newMemberButton.innerText = (lang=="ta")?"+ рокрпБродро┐роп роЙро▒рпБрокрпНрокро┐ройро░рпН":"+ New Member";
    }
    
    const closeModalButton = document.querySelector('.close-btn');
    if (closeModalButton) {
        closeModalButton.innerText = (lang=="ta")?"роорпВроЯрпБ":"Close";
    }

    // Update Placeholders & Labels
    document.getElementById("username").placeholder = (lang=="ta")?"рокропройро░рпН рокрпЖропро░рпН":"Username";
    document.getElementById("password").placeholder = (lang=="ta")?"роХроЯро╡рпБроЪрпНроЪрпКро▓рпН":"Password";
    document.getElementById("name").placeholder = (lang=="ta")?"рокрпЖропро░рпН":"Name";
    document.getElementById("age").placeholder = (lang=="ta")?"ро╡ропродрпБ":"Age";
    document.getElementById("mobile").placeholder = (lang=="ta")?"роХрпИрокрпЗроЪро┐ роОрогрпН":"Mobile";
    document.getElementById("email").placeholder = (lang=="ta")?"рооро┐ройрпНройроЮрпНроЪро▓рпН":"Email";
    document.getElementById("address").placeholder = (lang=="ta")?"роорпБроХро╡ро░ро┐":"Address";
    document.getElementById("aadhaar").placeholder = (lang=="ta")?"роЖродро╛ро░рпН роОрогрпН":"Aadhaar No";
    document.getElementById("startDateLabel").innerText = (lang=="ta")?"роЪрпЗро░рпНроХрпНроХрпИ родрпЗродро┐:":"Joining Date:";
    document.getElementById("planLabel").innerText = (lang=="ta")?"роЙро▒рпБрокрпНрокро┐ройро░рпН родро┐роЯрпНроЯроорпН:":"Membership Plan:";
    document.getElementById("medicalLabel").innerText = (lang=="ta")?"рооро░рпБродрпНродрпБро╡ рокро┐ро░роЪрпНроЪро┐ройрпИроХро│рпН:":"Medical Issues:";
    document.getElementById("medicalDetails").placeholder = (lang=="ta")?"роЖроорпН роОройрпНро▒ро╛ро▓рпН, роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯрпБ роОро┤рпБродро╡рпБроорпН":"If yes, specify details";
    document.getElementById("feesLabel").innerText = (lang=="ta")?"роХроЯрпНроЯрогроорпН роЪрпЖро▓рпБродрпНродрокрпНрокроЯрпНроЯродро╛?":"Fees Paid?";
    document.getElementById("paymentMethodLabel").innerText = (lang=="ta")?"роХроЯрпНроЯрог роорпБро▒рпИ:":"Payment Method:"; 
    document.getElementById("photoLabel").innerText = (lang=="ta")?"роЙро▒рпБрокрпНрокро┐ройро░рпН рокрпБроХрпИрокрпНрокроЯроорпН:":"Member Photo:";
    
    const searchPlaceholder = (lang=="ta")?"Reg.No, рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роорпКрокрпИро▓рпН роорпВро▓роорпН родрпЗроЯрпБ":"Search by Reg.No, Name, or Mobile";
    document.getElementById("memberSearchInput").placeholder = searchPlaceholder;
    document.getElementById("feeSearchInput").placeholder = searchPlaceholder;


    // Reload the tables to update column headers
    loadMembers();
}

// Language toggle
function toggleLanguage(){ 
    lang = (lang=="ta") ? "en" : "ta"; 
    updateLanguage(); 
}


// --- CORE FUNCTIONALITY ---

// Login
function login(){
    let u=document.getElementById("username").value;
    let p=document.getElementById("password").value;
    if(users[u] && users[u]===p){
        role=u;
        document.getElementById("loginPage").classList.add("hidden");
        if(u=="admin") document.getElementById("adminPage").classList.remove("hidden");
        // NOTE: The original code showed memberPage for non-admin login. Keeping this behavior.
        else document.getElementById("memberPage").classList.remove("hidden"); 
        loadMembers();
    } else { 
        displayMessage(lang=="ta"?"тЭМ родро╡ро▒ро╛рой рокропройро░рпН рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роХроЯро╡рпБроЪрпНроЪрпКро▓рпН!":"тЭМ Invalid credentials!"); 
    }
}

// Logout
function logout(){
    role="";
    document.getElementById("loginPage").classList.remove("hidden");
    document.getElementById("memberPage").classList.add("hidden");
    document.getElementById("adminPage").classList.add("hidden");
    document.getElementById("feePage").classList.add("hidden");
    closeModal();
    clearForm();
    document.getElementById("regNoDisplay").classList.add("hidden");
}

// Register or Update Member
function registerMember(){
    const file = document.getElementById("photo").files[0];
    const reader = new FileReader();
    let editId = document.getElementById("editId").value;
    let memberData;

    // Determine if photo data needs to be loaded or kept
    const handleMemberData = (photoBase64) => {
        
        let newRegNo = "";
        if (!editId) {
            newRegNo = generateRegNo(document.getElementById("startDate").value);
            if (!newRegNo) {
                // Registration failed because date was invalid
                return; 
            }
        }
        
        memberData = {
            id: editId ? parseInt(editId) : Date.now(),
            // Auto-generate RegNo if it's a new entry, otherwise retrieve existing
            regNo: editId ? members.find(m => m.id == editId).regNo : newRegNo,
            name: document.getElementById("name").value,
            age: document.getElementById("age").value,
            gender: "Not Specified", 
            mobile: document.getElementById("mobile").value,
            email: document.getElementById("email").value,
            address: document.getElementById("address").value,
            aadhaar: document.getElementById("aadhaar").value,
            plan: document.getElementById("plan").value,
            date: document.getElementById("startDate").value,
            medical: document.getElementById("medical").value,
            medicalDetails: document.getElementById("medicalDetails").value,
            amount: 0,
            feesPaid: document.getElementById("feesStatus").value,
            paymentMethod: document.getElementById("paymentMethod").value || "Not Specified",
            photo: photoBase64 
        };

        // --- VALIDATION ---
        if(!memberData.regNo || !memberData.name || !memberData.plan || !memberData.date || !memberData.mobile){ 
            displayMessage(lang=="ta"?"тЪая╕П рокрпЖропро░рпН, роХрпИрокрпЗроЪро┐ роОрогрпН, родро┐роЯрпНроЯроорпН рооро▒рпНро▒рпБроорпН роЪрпЗро░рпНроХрпНроХрпИ родрпЗродро┐ рокрпЛройрпНро▒ роЕродрпНродро┐ропро╛ро╡роЪро┐роп рокроХрпБродро┐роХро│рпИ роиро┐ро░рокрпНрокро╡рпБроорпН!":"тЪая╕П Fill essential fields like Name, Mobile, Plan, and Joining Date!"); 
            return; 
        }
        
        // Load existing members from local storage
        members=JSON.parse(localStorage.getItem("members"))||[];

        if(editId){
            members=members.map(m=> m.id==editId ? memberData : m);
        } else { 
            members.push(memberData); 
        }
        localStorage.setItem("members",JSON.stringify(members));
        
        // Show the generated ID only for new registration
        if (!editId) {
              const regDisplay = document.getElementById("regNoDisplay");
              regDisplay.innerHTML = `${lang === "ta" ? "рокрпБродро┐роп рокродро┐ро╡рпБ роОрогрпН" : "New Reg. No"}: <strong>${memberData.regNo}</strong>`;
              regDisplay.classList.remove("hidden");
        }

        clearForm();
        displayMessage(lang=="ta"?"тЬЕ роЙро▒рпБрокрпНрокро┐ройро░рпН рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯродрпБ":"тЬЕ Member Registered/Updated");
        loadMembers();
    };

    // Photo handling logic
    if(file){
        if (file.size > 2097152) { // 2MB limit
            displayMessage(lang=="ta"?"тЪая╕П рокрпБроХрпИрокрпНрокроЯроорпН 2MB роХрпНроХрпБроорпН роХрпБро▒рпИро╡ро╛роХ роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.":"тЪая╕П Photo must be less than 2MB.");
            return;
        }
        reader.onload = (e) => handleMemberData(e.target.result);
        reader.readAsDataURL(file);
    }
    else {
        // Use existing photo data for update or placeholder for new registration
        if(editId){
            let existing=members.find(m=>m.id==editId);
            handleMemberData(existing ? existing.photo : 'https://placehold.co/70x70/cccccc/333333?text=N/A');
        } else {
            handleMemberData('https://placehold.co/70x70/cccccc/333333?text=N/A'); 
        }
    }
}

// Edit Member
function editMember(id){
    let m=members.find(x=>x.id==id);
    if(!m) return;
    
    // Hide auto-generated ID display when editing
    document.getElementById("regNoDisplay").classList.add("hidden");
    
    document.getElementById("editId").value=m.id;
    document.getElementById("name").value=m.name;
    document.getElementById("age").value=m.age;
    document.getElementById("mobile").value=m.mobile;
    document.getElementById("email").value=m.email;
    document.getElementById("address").value=m.address;
    document.getElementById("aadhaar").value=m.aadhaar;
    
    // Ensure select options are re-rendered based on language before setting value
    updateSelectOptions(); 
    
    document.getElementById("plan").value=m.plan;
    document.getElementById("startDate").value=m.date;
    document.getElementById("medical").value=m.medical;
    document.getElementById("medicalDetails").value=m.medicalDetails;
    // Normalize feesPaid value to check against 'Paid'
    document.getElementById("feesStatus").value=m.feesPaid.includes("Paid") || m.feesPaid.includes("роХроЯрпНроЯрокрпНрокроЯрпНроЯродрпБ") ? "Paid" : "Not Paid";
    document.getElementById("paymentMethod").value=m.paymentMethod || ""; // Set new field
    
    document.getElementById("memberPage").classList.remove("hidden");
    document.getElementById("adminPage").classList.add("hidden");
    document.getElementById("registerBtn").innerText = lang === "ta" ? "рокрпБродрпБрокрпНрокро┐роХрпНроХ" : "Update";

    window.scrollTo(0,0);
}

// Remove Member
function removeMember(id) {
    const confirmation = lang === "ta" 
        ? "роЙро▒рпБрокрпНрокро┐ройро░рпН рокродро┐ро╡рпИ роирпАроХрпНроХ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛? (OK/Cancel)" 
        : "Are you sure you want to delete this member record? (OK/Cancel)";

    // Use a custom modal for confirmation in a real app, but for simplicity here, we'll skip confirmation logic 
    // and just delete, displaying a message.
    
    members = members.filter(m => m.id !== id);
    localStorage.setItem("members", JSON.stringify(members));
    displayMessage(lang === "ta" ? "ЁЯЧСя╕П роЙро▒рпБрокрпНрокро┐ройро░рпН рокродро┐ро╡рпБ роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ" : "ЁЯЧСя╕П Member record deleted");
    loadMembers();
}


// Clear Form
function clearForm(){
    document.getElementById("editId").value="";
    ["name","age","mobile","email","address","aadhaar","startDate","medicalDetails"].forEach(id=>document.getElementById(id).value="");
    document.getElementById("photo").value = null; // Clear file input
    document.getElementById("medical").value="No"; // Reset default
    document.getElementById("feesStatus").value="Not Paid"; // Reset default
    document.getElementById("paymentMethod").value=""; // Reset default
    document.getElementById("registerBtn").innerText = lang === "ta" ? "рокродро┐ро╡рпБ" : "Register";
    // Reset dropdowns based on current language
    updateSelectOptions(); 
}

// Display Member Details in Modal
function showMember(id) {
    const m = members.find(x => x.id === id);
    if (!m) return;

    const detailTable = document.getElementById('detailTable');
    const modalPhoto = document.getElementById('modalPhoto');
    const paidText = lang=="ta"?"роХроЯрпНроЯрокрпНрокроЯрпНроЯродрпБ":"Paid";
    const notPaidText = lang=="ta"?"роХроЯрпНроЯрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ":"Not Paid";
    const statusColor = m.feesPaid.includes(paidText) ? 'green' : 'red';

    const getLabel = (key) => {
        const labels = {
            'regNo': 'Reg. No', 'name': lang === "ta" ? "рокрпЖропро░рпН" : "Name", 'age': lang === "ta" ? "ро╡ропродрпБ" : "Age",
            'mobile': lang === "ta" ? "роХрпИрокрпЗроЪро┐ роОрогрпН" : "Mobile", 'email': lang === "ta" ? "рооро┐ройрпНройроЮрпНроЪро▓рпН" : "Email",
            'address': lang === "ta" ? "роорпБроХро╡ро░ро┐" : "Address", 'aadhaar': lang === "ta" ? "роЖродро╛ро░рпН роОрогрпН" : "Aadhaar No",
            'plan': lang === "ta" ? "родро┐роЯрпНроЯроорпН" : "Plan", 'date': lang === "ta" ? "роЪрпЗро░рпНроХрпНроХрпИ родрпЗродро┐" : "Joining Date",
            'medical': lang === "ta" ? "рооро░рпБродрпНродрпБро╡ рокро┐ро░роЪрпНроЪро┐ройрпИроХро│рпН" : "Medical Issues",
            'medicalDetails': lang === "ta" ? "рооро░рпБродрпНродрпБро╡ ро╡ро┐ро╡ро░роЩрпНроХро│рпН" : "Medical Details",
            'feesPaid': lang === "ta" ? "роХроЯрпНроЯрог роиро┐ро▓рпИ" : "Fees Status",
            'paymentMethod': lang === "ta" ? "роХроЯрпНроЯрог роорпБро▒рпИ" : "Payment Method"
        };
        return labels[key] || key;
    };

    const tableContent = `
        <thead class="bg-gray-50"><tr><th class="px-4 py-2">${lang === "ta" ? "ро╡ро┐ро╡ро░роорпН" : "Detail"}</th><th class="px-4 py-2">${lang === "ta" ? "роородро┐рокрпНрокрпБ" : "Value"}</th></tr></thead>
        <tbody>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('regNo')}</td><td class="px-4 py-2">${m.regNo}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('name')}</td><td class="px-4 py-2">${m.name}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('mobile')}</td><td class="px-4 py-2">${m.mobile}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('plan')}</td><td class="px-4 py-2">${m.plan}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('date')}</td><td class="px-4 py-2">${m.date}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('paymentMethod')}</td><td class="px-4 py-2">${m.paymentMethod}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('feesPaid')}</td><td class="px-4 py-2 font-bold" style="color: ${statusColor};">${m.feesPaid}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('medical')}</td><td class="px-4 py-2">${m.medical}</td></tr>
            <tr class="border-b"><td class="px-4 py-2 font-semibold">${getLabel('medicalDetails')}</td><td class="px-4 py-2 text-wrap">${m.medicalDetails || 'N/A'}</td></tr>
        </tbody>
    `;

    document.getElementById('modalTitle').innerText = (lang === "ta" ? "роЙро▒рпБрокрпНрокро┐ройро░рпН ро╡ро┐ро╡ро░роЩрпНроХро│рпН: " : "Member Details: ") + m.name;
    modalPhoto.src = m.photo || 'https://placehold.co/70x70/cccccc/333333?text=N/A';
    detailTable.innerHTML = tableContent;
    document.getElementById('memberModal').style.display = 'flex';
}

// Toggle Fee Status (Mark Paid/Not Paid)
function toggleFeeStatus(id) {
    let m = members.find(x => x.id === id);
    if (!m) return;

    const paidText = lang=="ta"?"роХроЯрпНроЯрокрпНрокроЯрпНроЯродрпБ":"Paid";
    const notPaidText = lang=="ta"?"роХроЯрпНроЯрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ":"Not Paid";
    const isPaid = m.feesPaid.includes(paidText);

    if (isPaid) {
        // Mark as Not Paid
        m.feesPaid = notPaidText;
        displayMessage(lang === "ta" ? `ЁЯФ┤ ${m.name} роХроЯрпНроЯрогроорпН роЪрпЖро▓рпБродрпНродрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ роОройрпНро▒рпБ роХрпБро▒ро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ` : `ЁЯФ┤ ${m.name} marked Not Paid`);
    } else {
        // Mark as Paid, update date to today
        m.feesPaid = paidText;
        // Update the date to today's date upon payment
        const today = new Date();
        m.date = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
        displayMessage(lang === "ta" ? `ЁЯЯв ${m.name} роХроЯрпНроЯрогроорпН роЪрпЖро▓рпБродрпНродрокрпНрокроЯрпНроЯродрпБ роОройрпНро▒рпБ роХрпБро▒ро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ` : `ЁЯЯв ${m.name} marked Paid`);
    }

    localStorage.setItem("members", JSON.stringify(members));
    loadMembers(); // Reload table to reflect change
}

// Load Members and update tables
function loadMembers(){
    // 1. Load and update member status logic
    members=JSON.parse(localStorage.getItem("members"))||[];
    const paidText = lang=="ta"?"роХроЯрпНроЯрокрпНрокроЯрпНроЯродрпБ":"Paid";
    const notPaidText = lang=="ta"?"роХроЯрпНроЯрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ":"Not Paid";
    
    let today=new Date();
    
    members.forEach(m=>{
        // The stored feesPaid value might be in either language. Check for both.
        const isPaid = m.feesPaid === "Paid" || m.feesPaid === "роХроЯрпНроЯрокрпНрокроЯрпНроЯродрпБ";
        
        if(m.date && isPaid){
            let start=new Date(m.date);
            let planType=m.plan.split(" - ")[0];
            let renewalDate = new Date(m.date);
                
            if(planType.includes("Monthly") || planType.includes("рооро╛родроорпН")){ renewalDate.setMonth(start.getMonth()+1); }
            else if(planType.includes("Quarterly") || planType.includes("роХро╛ро▓ро╛рогрпНроЯрпБ")){ renewalDate.setMonth(start.getMonth()+3); }
            else if(planType.includes("Annual") || planType.includes("ро╡ро░рпБроЯроорпН")){ renewalDate.setFullYear(start.getFullYear()+1); }

            // Reset time part for accurate date comparison
            today.setHours(0, 0, 0, 0);
            renewalDate.setHours(0, 0, 0, 0);

            if(today>renewalDate) {
                m.feesPaid = notPaidText;
            } else {
                // Ensure it is translated correctly for display
                m.feesPaid = paidText; 
            }
        } else {
            // Ensure it is translated correctly for display
            m.feesPaid = notPaidText;
        }
        // Ensure payment method is not null for display
        if (!m.paymentMethod) m.paymentMethod = "Not Specified";
    });
    localStorage.setItem("members",JSON.stringify(members));

    if(role=="admin"){
        
        // 2. Determine Search Query
        let searchInputId = 'memberSearchInput';
        // If the fee page is visible, use the fee search input
        if (!document.getElementById('feePage').classList.contains('hidden')) {
            searchInputId = 'feeSearchInput';
        }

        const searchInput = document.getElementById(searchInputId);
        let currentMembers = [...members];
        let query = "";

        if (searchInput) {
            query = searchInput.value.toLowerCase().trim();
        }

        if (query.length > 0) {
            currentMembers = currentMembers.filter(m =>
                m.regNo.toLowerCase().includes(query) ||
                m.name.toLowerCase().includes(query) ||
                m.mobile.includes(query)
            );
        }

        // 3. Render Member Table (Admin Page)
        let table=document.getElementById("memberTable");
        const memberHeaders = `
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"рокрпБроХрпИрокрпНрокроЯроорпН":"Photo"}</th>
                    <th class="px-4 py-2 bg-blue-600 text-white">Reg.No</th>
                    <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"рокрпЖропро░рпН":"Name"}</th>
                    <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"родро┐роЯрпНроЯроорпН":"Plan"}</th>
                    <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"роЪрпЗро░рпНроХрпНроХрпИ родрпЗродро┐":"Joining Date"}</th>
                    <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"роХроЯрпНроЯрог роиро┐ро▓рпИ":"Fees Paid"}</th>
                    <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"роЪрпЖропро▓рпН":"Actions"}</th>
                </tr>
            </thead>
            <tbody>`;
        table.innerHTML=memberHeaders;
        currentMembers.forEach(m=>{
            table.innerHTML+=`<tr class="hover:bg-gray-50 border-b">
                <td class="px-4 py-3 text-center"><img class="member-photo mx-auto" src="${m.photo}" onerror="this.onerror=null;this.src='https://placehold.co/70x70/cccccc/333333?text=N/A';" /></td>
                <td class="px-4 py-3">${m.regNo}</td>
                <td class="px-4 py-3"><a href="#" onclick="showMember(${m.id}); return false;" class="text-blue-600 hover:text-blue-800 font-medium">${m.name}</a></td>
                <td class="px-4 py-3 text-xs">${m.plan.split(' - ')[0]}</td>
                <td class="px-4 py-3 text-xs">${m.date}</td>
                <td class="px-4 py-3 font-semibold text-xs" style="color: ${m.feesPaid.includes(paidText) ? 'green' : 'red'};">${m.feesPaid}</td>
                <td class="px-4 py-3 text-center">
                    <button onclick='editMember(${m.id})' class="bg-yellow-400 text-gray-800 p-1.5 text-xs rounded-md hover:bg-yellow-500 transition duration-150 mr-1">тЬПя╕П</button>
                    <button onclick='removeMember(${m.id})' class="bg-red-500 text-white p-1.5 text-xs rounded-md hover:bg-red-600 transition duration-150">тЭМ</button>
                </td>
            </tr>`;
        });
        table.innerHTML += `</tbody>`;

        // 4. Render Fee Table (Fees Page)
        let feeTable=document.getElementById("feeTable");
        if(feeTable){
            const feeHeaders = `
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-4 py-2 bg-blue-600 text-white">Reg.No</th>
                        <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"рокрпЖропро░рпН":"Name"}</th>
                        <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"родро┐роЯрпНроЯроорпН":"Plan"}</th>
                        <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"роХроЯрпНроЯрог роорпБро▒рпИ":"P. Method"}</th>
                        <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"роХроЯрпНроЯрог родрпКроХрпИ (тВ╣)":"Fee Amount (тВ╣)"}</th>
                        <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"роХроЯрпНроЯрог роиро┐ро▓рпИ":"Fees Paid"}</th>
                        <th class="px-4 py-2 bg-blue-600 text-white">${lang=="ta"?"роЪрпЖропро▓рпН":"Actions"}</th>
                    </tr>
                </thead>
                <tbody>`;
            feeTable.innerHTML=feeHeaders;
            currentMembers.forEach(m=>{
                const planAmount = m.plan.split(' - ')[1] ? m.plan.split(' - ')[1].replace('тВ╣', '') : 'N/A';
                feeTable.innerHTML+=`<tr class="hover:bg-gray-50 border-b">
                    <td class="px-4 py-3">${m.regNo}</td>
                    <td class="px-4 py-3 text-sm">${m.name}</td>
                    <td class="px-4 py-3 text-sm">${m.plan.split(' - ')[0]}</td>
                    <td class="px-4 py-3 text-sm">${m.paymentMethod}</td>
                    <td class="px-4 py-3 text-sm font-medium">тВ╣${planAmount}</td>
                    <td class="px-4 py-3 font-semibold text-xs" style="color: ${m.feesPaid.includes(paidText) ? 'green' : 'red'};">${m.feesPaid}</td>
                    <td class="px-4 py-3 text-center">
                        <button onclick='toggleFeeStatus(${m.id})' class="bg-green-500 text-white p-1.5 text-xs rounded-md hover:bg-green-600 transition duration-150">
                            ${m.feesPaid.includes(paidText) ? (lang=="ta"?"роиро┐ро▓рпИропрпИ рооро╛ро▒рпНро▒рпБ":"Toggle Paid") : (lang=="ta"?"роХроЯрпНроЯрокрпНрокроЯрпНроЯродрпБ роОройрпНро▒рпБ роХрпБро▒ро┐роХрпНроХ":"Mark Paid")}
                        </button>
                    </td>
                </tr>`;
            });
            feeTable.innerHTML += `</tbody>`;
        }
    }
}

// Initialize language and load members on load
window.onload = () => {
    // Ensure all select elements are initialized with options based on default language
    updateLanguage(); 
    loadMembers(); // Load data initially
};

</script>
</body>
</html>
